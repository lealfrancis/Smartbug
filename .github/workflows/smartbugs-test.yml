name: SmartBugs CI
on: [push]
jobs:
  run-all-once:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        tool: ["all"]
        contract: ["'samples/*'"]
        python-version: ["3.6.9"]
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      - name: setup
        run: ./setup-venv.sh
      - name: Execute ${{ matrix.tool }} on ${{ matrix.contract }}
        run: source venv/bin/activate; ./smartbugs -t ${{ matrix.tool }} -f ${{ matrix.contract }} --sarif --runid github --timeout 300 --mem-limit 1g --cpu-quota 150000 --processes 2
      - name: Reparse results  of ${{matrix.tool}} on ${{ matrix.contract }}
        run: source venv/bin/activate; ./reparse --sarif results
      - name: Verify results of ${{matrix.tool}} on ${{ matrix.contract }}
        run: source venv/bin/activate; ./results2csv -x start duration -- results | fgrep -v DOCKER_ | diff .github/samples.csv -
      - name: Upload SARIF file for slither, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/slither/github/simple_dao.sol/result.sarif
          category: slither/sol
      - name: Upload SARIF file for slither, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/slither/github/unchecked_return_value.sol/result.sarif
          category: slither/sol
      - name: Upload SARIF file for smartcheck, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/smartcheck/github/simple_dao.sol/result.sarif
          category: smartcheck/sol
      - name: Upload SARIF file for smartcheck, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/smartcheck/github/unchecked_return_value.sol/result.sarif
          category: smartcheck/sol
      - name: Upload SARIF file for honeybadger, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/honeybadger/github/unchecked_return_value.rt.hex/result.sarif
          category: honeybadger/rt.hex
      - name: Upload SARIF file for honeybadger, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/honeybadger/github/simple_dao.sol/result.sarif
          category: honeybadger/sol
      - name: Upload SARIF file for honeybadger, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/honeybadger/github/unchecked_return_value.sol/result.sarif
          category: honeybadger/sol
      - name: Upload SARIF file for honeybadger, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/honeybadger/github/simple_dao.rt.hex/result.sarif
          category: honeybadger/rt.hex
      - name: Upload SARIF file for conkas, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/conkas/github/unchecked_return_value.rt.hex/result.sarif
          category: conkas/rt.hex
      - name: Upload SARIF file for conkas, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/conkas/github/simple_dao.sol/result.sarif
          category: conkas/sol
      - name: Upload SARIF file for conkas, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/conkas/github/unchecked_return_value.sol/result.sarif
          category: conkas/sol
      - name: Upload SARIF file for conkas, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/conkas/github/simple_dao.rt.hex/result.sarif
          category: conkas/rt.hex
      - name: Upload SARIF file for oyente, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/oyente/github/unchecked_return_value.rt.hex/result.sarif
          category: oyente/rt.hex
      - name: Upload SARIF file for oyente, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/oyente/github/simple_dao.sol/result.sarif
          category: oyente/sol
      - name: Upload SARIF file for oyente, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/oyente/github/unchecked_return_value.sol/result.sarif
          category: oyente/sol
      - name: Upload SARIF file for oyente, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/oyente/github/simple_dao.rt.hex/result.sarif
          category: oyente/rt.hex
      - name: Upload SARIF file for maian, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/unchecked_return_value.rt.hex/result.sarif
          category: maian/rt.hex
      - name: Upload SARIF file for maian, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/simple_dao.sol/result.sarif
          category: maian/sol
      - name: Upload SARIF file for maian, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/unchecked_return_value.sol/result.sarif
          category: maian/sol
      - name: Upload SARIF file for maian, mode hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/unchecked_return_value.hex/result.sarif
          category: maian/hex
      - name: Upload SARIF file for maian, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/simple_dao.rt.hex/result.sarif
          category: maian/rt.hex
      - name: Upload SARIF file for maian, mode hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/maian/github/simple_dao.hex/result.sarif
          category: maian/hex
      - name: Upload SARIF file for madmax, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/madmax/github/unchecked_return_value.rt.hex/result.sarif
          category: madmax/rt.hex
      - name: Upload SARIF file for madmax, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/madmax/github/simple_dao.rt.hex/result.sarif
          category: madmax/rt.hex
      - name: Upload SARIF file for pakala, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/pakala/github/unchecked_return_value.rt.hex/result.sarif
          category: pakala/rt.hex
      - name: Upload SARIF file for pakala, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/pakala/github/simple_dao.rt.hex/result.sarif
          category: pakala/rt.hex
      - name: Upload SARIF file for ethainter, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/ethainter/github/unchecked_return_value.rt.hex/result.sarif
          category: ethainter/rt.hex
      - name: Upload SARIF file for ethainter, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/ethainter/github/simple_dao.rt.hex/result.sarif
          category: ethainter/rt.hex
      - name: Upload SARIF file for vandal, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/vandal/github/unchecked_return_value.rt.hex/result.sarif
          category: vandal/rt.hex
      - name: Upload SARIF file for vandal, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/vandal/github/simple_dao.rt.hex/result.sarif
          category: vandal/rt.hex
      - name: Upload SARIF file for teether, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/teether/github/unchecked_return_value.rt.hex/result.sarif
          category: teether/rt.hex
      - name: Upload SARIF file for teether, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/teether/github/simple_dao.rt.hex/result.sarif
          category: teether/rt.hex
      - name: Upload SARIF file for osiris, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/osiris/github/unchecked_return_value.rt.hex/result.sarif
          category: osiris/rt.hex
      - name: Upload SARIF file for osiris, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/osiris/github/simple_dao.sol/result.sarif
          category: osiris/sol
      - name: Upload SARIF file for osiris, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/osiris/github/unchecked_return_value.sol/result.sarif
          category: osiris/sol
      - name: Upload SARIF file for osiris, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/osiris/github/simple_dao.rt.hex/result.sarif
          category: osiris/rt.hex
      - name: Upload SARIF file for solhint, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/solhint/github/simple_dao.sol/result.sarif
          category: solhint/sol
      - name: Upload SARIF file for solhint, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/solhint/github/unchecked_return_value.sol/result.sarif
          category: solhint/sol
      - name: Upload SARIF file for securify, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/securify/github/unchecked_return_value.rt.hex/result.sarif
          category: securify/rt.hex
      - name: Upload SARIF file for securify, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/securify/github/simple_dao.sol/result.sarif
          category: securify/sol
      - name: Upload SARIF file for securify, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/securify/github/unchecked_return_value.sol/result.sarif
          category: securify/sol
      - name: Upload SARIF file for securify, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/securify/github/simple_dao.rt.hex/result.sarif
          category: securify/rt.hex
      - name: Upload SARIF file for ethor, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/ethor/github/unchecked_return_value.rt.hex/result.sarif
          category: ethor/rt.hex
      - name: Upload SARIF file for ethor, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/ethor/github/simple_dao.rt.hex/result.sarif
          category: ethor/rt.hex
      - name: Upload SARIF file for mythril-0.23.5, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/unchecked_return_value.rt.hex/result.sarif
          category: mythril-0.23.5/rt.hex
      - name: Upload SARIF file for mythril-0.23.5, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/simple_dao.sol/result.sarif
          category: mythril-0.23.5/sol
      - name: Upload SARIF file for mythril-0.23.5, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/unchecked_return_value.sol/result.sarif
          category: mythril-0.23.5/sol
      - name: Upload SARIF file for mythril-0.23.5, mode hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/unchecked_return_value.hex/result.sarif
          category: mythril-0.23.5/hex
      - name: Upload SARIF file for mythril-0.23.5, mode rt.hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/simple_dao.rt.hex/result.sarif
          category: mythril-0.23.5/rt.hex
      - name: Upload SARIF file for mythril-0.23.5, mode hex
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/mythril-0.23.5/github/simple_dao.hex/result.sarif
          category: mythril-0.23.5/hex
      - name: Upload SARIF file for manticore-0.3.7, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/manticore-0.3.7/github/simple_dao.sol/result.sarif
          category: manticore-0.3.7/sol
      - name: Upload SARIF file for manticore-0.3.7, mode sol
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results/manticore-0.3.7/github/unchecked_return_value.sol/result.sarif
          category: manticore-0.3.7/sol
